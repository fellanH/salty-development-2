(function(I){typeof define=="function"&&define.amd?define(I):I()})(function(){"use strict";const I={ACCESS_TOKEN:"pk.eyJ1IjoiZmVsaXhoZWxsc3Ryb20iLCJhIjoiY20zaXhucjcwMDVwdTJqcG83ZjMxemJlciJ9._TipZd1k8nMEslWbCDg6Eg",STYLE:"mapbox://styles/felixhellstrom/cmc0qhn8p00gs01s921jm5bkv",DEFAULT_ZOOM:2,DESKTOP_START_POSITION:[-123.046253,33.837038],MOBILE_START_POSITION:[-140.3628729,33.900661],START_PITCH:0,DETAIL_ZOOM:15,MOBILE_BREAKPOINT:768},w={selectState:{description:"Action when a state is clicked on the map or in the list.",actions:[{type:"FLY_TO",zoomLevel:5,speed:2},{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"list"}]},selectRegion:{description:"Action when a region/city cluster is clicked.",actions:[{type:"FLY_TO",zoomLevel:9,speed:2},{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"list"}]},selectBeachFromMap:{description:"Action when a beach is selected directly from the map.",actions:[{type:"UPDATE_APP_STATE"},{type:"FLY_TO",zoomLevel:14.5,speed:2,when:{context:"isMobile"}},{type:"SHOW_POPUP",delay:100},{type:"SHOW_SIDEBAR",sidebar:"detail",when:{context:"isMobile"}}]},selectBeachFromList:{description:"Action when a beach is selected from a sidebar list.",actions:[{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"detail"},{type:"FLY_TO",zoomLevel:14.5,speed:2},{type:"SHOW_POPUP",delay:100,when:{context:"isDesktop"}}]},selectBeachFromPopup:{description:"Action when a beach popup is clicked.",actions:[{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"detail"},{type:"FLY_TO",zoomLevel:14,speed:1.2,when:{context:"isMobile"}}]},selectPOIFromMap:{description:"Action when a POI marker is clicked directly from the map.",actions:[{type:"UPDATE_APP_STATE"},{type:"FLY_TO",zoomLevel:16,speed:2,when:{context:"isMobile"}},{type:"SHOW_POPUP",delay:100},{type:"SHOW_SIDEBAR",sidebar:"detail",when:{context:"isMobile"}}]},selectPOIFromList:{description:"Action when a POI is selected from a sidebar list.",actions:[{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"detail"},{type:"FLY_TO",zoomLevel:16,speed:2},{type:"SHOW_POPUP",delay:100,when:{context:"isDesktop"}}]},selectPOIFromPopup:{description:"Action when a POI popup is clicked.",actions:[{type:"UPDATE_APP_STATE"},{type:"SHOW_SIDEBAR",sidebar:"detail"},{type:"FLY_TO",zoomLevel:16,speed:1.2,when:{context:"isMobile"}}]},navigateHome:{description:"Action for buttons navigating to the home screen.",actions:[{type:"SHOW_SIDEBAR",sidebar:"home"}]},navigateToList:{description:"Action for buttons that should open the list view.",actions:[{type:"SHOW_SIDEBAR",sidebar:"list"}]},closeDetailAndReset:{description:"Action for the close button in the detail view to reset the map.",actions:[{type:"SHOW_SIDEBAR",sidebar:"list"},{type:"FLY_TO_DEFAULT_POSITION"}]},backToList:{description:"Action for the back button in detail view to return to the list, close popups, and zoom out.",actions:[{type:"SHOW_SIDEBAR",sidebar:"list"},{type:"CLOSE_ALL_POPUPS"}]},toggleFullscreen:{description:"Action for the fullscreen toggle button.",actions:[{type:"TOGGLE_FULLSCREEN"}]}},y={BASE_URL:"https://salty-development-2.vercel.app",WEATHER_PROXY_URL:""},d={MAP:I,EVENT_ACTIONS:w,API:y,WEBFLOW:{SITE_ID:"677e87dd7e4a4c73cbae4e0e",BEACHES_COLLECTION_ID:"6786e26d4438e40d5e56c085",POI_COLLECTION_ID:"6786de91c5b6dbbb511c16df"},SELECTORS:{MAP_CONTAINER:"#map-container",DETAIL_SIDEBAR:"#detail-sidebar",DETAIL_SIDEBAR_CONTENT:"#detail-sidebar-content",BEACH_LIST_ITEMS:".beach-list-item",SIDEBAR_WRAPPER:'[sidebar="wrapper"]',SIDEBAR_HOME:'[sidebar="home"]',SIDEBAR_BEACH_LIST:'[sidebar="beach-list"]',SIDEBAR_BEACH:'[sidebar="beach"]',BEACH_LIST_CONTAINER:".beach-list_list",BEACH_LIST_ITEM_TEMPLATE:"#beach-list-item-template",TEMPLATE_BEACH_LINK:".beach-info-small_wrapper",TEMPLATE_BEACH_IMAGE:'[beach-list-item="image"]',TEMPLATE_BEACH_TITLE:'[beach-list-item="title"]',TEMPLATE_BEACH_LOCATION_WRAPPER:'[beach-list-item="location-wrapper"]',TEMPLATE_BEACH_CLUSTER:'[beach-list-item="location-cluster"]',TEMPLATE_BEACH_STATE:'[beach-list-item="state"]',TEMPLATE_BEACH_DELIMITER:".delimiter",BEACH_DETAIL_IMAGE:'[beach-data="image"]',BEACH_DETAIL_TITLE:'[beach-data="title"]',BEACH_DETAIL_ADDRESS_LINK:'[beach-data="address-link"]',BEACH_DETAIL_ADDRESS_TEXT:'[beach-data="address-text"]',BEACH_DETAIL_WEBSITE_LINK:'[beach-data="website-link"]',BEACH_DETAIL_WEBSITE_TEXT:'[beach-data="website-text"]',BEACH_DETAIL_RESTROOMS:'[beach-data="restrooms"]',BEACH_DETAIL_SHOWERS:'[beach-data="showers"]',BEACH_DETAIL_PETS:'[beach-data="pets"]',BEACH_DETAIL_PARKING:'[beach-data="parking"]',BEACH_DETAIL_CAMPING:'[beach-data="camping"]',WEATHER_AIR_TEMP:'[beach-data="air-temp"]',WEATHER_FEELS_LIKE:'[beach-data="feels-like"]',WEATHER_HUMIDITY:'[beach-data="humidity"]',WEATHER_WIND:'[beach-data="wind"]',WEATHER_WIND_DIRECTION:'[beach-data="wind-direction"]',WEATHER_AQI:'[beach-data="aqi"]',WEATHER_RAINFALL:'[beach-data="rainfall"]',WEATHER_PRESSURE:'[beach-data="pressure"]',WEATHER_PM25:'[beach-data="pm25"]',WEATHER_PM10:'[beach-data="pm10"]',WEATHER_WATER_TEMP:'[beach-data="water-temp"]',WEATHER_WAVE_HEIGHT:'[beach-data="wave-height"]',WEATHER_OCEAN_CURRENT:'[beach-data="ocean-current"]',WEATHER_UV_INDEX:'[beach-data="uv-index"]',WEATHER_CLOUD_COVER:'[beach-data="cloud-cover"]',WEATHER_SUNSET:'[beach-data="sunset"]',BEACH_DETAIL_BACK_BUTTON:".modal_back-button",BEACH_DETAIL_CLOSE_BUTTON:".modal_close-button"},UI:{MAP_FLY_SPEED:1.2,RENDER_DELAY:150,POPUP_OFFSET:[0,-30],HOVER_POPUP_DELAY:300,LIST_ITEM_HEIGHT:80},FEATURE_CONFIG:{state:{templateId:"#state-list-item-template",actionName:"selectState",dataMapping:{'[state-list-item="image"]':{type:"image",source:e=>e.IMAGE||"https://cdn.prod.website-files.com/677e87dd7e4a4c73cbae4e0e/677e87dd7e4a4c73cbae4ee3_placeholder-image.svg"},'[state-list-item="title"]':{type:"text",source:e=>e.NAME||"Unnamed State"}}},region:{templateId:"#city-list-item-template",actionName:"selectRegion",dataMapping:{'[city-list-item="image"]':{type:"image",source:e=>e.Image||"https://cdn.prod.website-files.com/677e87dd7e4a4c73cbae4e0e/677e87dd7e4a4c73cbae4ee3_placeholder-image.svg"},'[city-list-item="title"]':{type:"text",source:e=>e.name||"Unnamed Region"}}},beach:{templateId:"#beach-list-item-template",actionName:"selectBeachFromList",dataMapping:{'[beach-list-item="image"]':{type:"image",source:e=>e["Main Image"]||"https://cdn.prod.website-files.com/677e87dd7e4a4c73cbae4e0e/677e87dd7e4a4c73cbae4ee3_placeholder-image.svg"},'[beach-list-item="title"]':{type:"text",source:e=>e.Name||"Beach Title"},'[beach-list-item="location-cluster"]':{type:"text",source:e=>e["Location Cluster"]},'[beach-list-item="state"]':{type:"text",source:e=>e.State},'[beach-list-item="delimiter"]':{type:"style",style:{display:"inline"}}}},poi:{templateId:"#beach-list-item-template",actionName:"selectPOIFromList",dataMapping:{'[beach-list-item="image"]':{type:"image",source:e=>e.mainImageUrl||e["Main Image"]||e.imageUrl||"https://cdn.prod.website-files.com/677e87dd7e4a4c73cbae4e0e/677e87dd7e4a4c73cbae4ee3_placeholder-image.svg"},'[beach-list-item="title"]':{type:"text",source:e=>e.name||e.Name||"Point of Interest"},'[beach-list-item="location-cluster"]':{type:"text",source:e=>e.categoryName||e.category||e.type||"POI"},'[beach-list-item="state"]':{type:"text",source:e=>e.customIconName||e["Custom Icon"]||e.State||e.state||""},'[beach-list-item="delimiter"]':{type:"style",style:{display:"inline"}}}}}},f=new Map,p={subscribe(e,t){f.has(e)||f.set(e,[]);const i=f.get(e);return i.push(t),console.log(`[EventBus] Subscribed to "${e}"`),{unsubscribe(){const a=i.indexOf(t);a>-1&&i.splice(a,1)}}},publish(e,t){f.has(e)&&(console.log(`[EventBus] Publishing "${e}"`,t),f.get(e).forEach(i=>i(t)))}};let h={map:null,currentSelection:{id:null,type:null,feature:null},cache:{weatherData:new Map,visibleFeatures:new Map,beachData:new Map,poiData:new Map},ui:{currentSidebar:"home",isMobile:!1,isLoading:!1,elements:{},openPopups:[]}};function D(e,t){switch(t.type){case"SET_MAP_INSTANCE":return{...e,map:t.payload};case"SET_SELECTION":return console.log("[DEBUG] SET_SELECTION payload:",t.payload),e.currentSelection.id===t.payload.id&&e.currentSelection.type===t.payload.type?e:{...e,currentSelection:t.payload};case"CLEAR_SELECTION":return{...e,currentSelection:{id:null,type:null,feature:null}};case"SET_VISIBLE_FEATURES":const i=new Map;return t.payload.forEach(r=>{const m=r.properties["Item ID"]||r.properties.NAME||r.properties.Name||r.id;m&&i.set(String(m),r)}),{...e,cache:{...e.cache,visibleFeatures:i}};case"CLEAR_VISIBLE_FEATURES":return{...e,cache:{...e.cache,visibleFeatures:new Map}};case"SET_UI_STATE":return{...e,ui:{...e.ui,...t.payload}};case"SET_WEATHER_DATA":const a=new Map(e.cache.weatherData);return a.set(t.payload.id,t.payload.data),{...e,cache:{...e.cache,weatherData:a}};case"DELETE_WEATHER_DATA":const s=new Map(e.cache.weatherData);return s.delete(t.payload.id),{...e,cache:{...e.cache,weatherData:s}};case"ADD_OPEN_POPUP":return{...e,ui:{...e.ui,openPopups:[...e.ui.openPopups,t.payload]}};case"REMOVE_OPEN_POPUP":return{...e,ui:{...e.ui,openPopups:e.ui.openPopups.filter(r=>r!==t.payload)}};case"CLEAR_OPEN_POPUPS":return{...e,ui:{...e.ui,openPopups:[]}};case"SET_ALL_BEACH_DATA":const n=new Map;return t.payload.forEach(r=>n.set(r.id,r)),{...e,cache:{...e.cache,beachData:n}};case"SET_ALL_POI_DATA":const c=new Map;return t.payload.forEach(r=>c.set(r.id,r)),{...e,cache:{...e.cache,poiData:c}};default:return e}}const o={dispatch(e){const t=h;h=D(h,e),console.log(`[AppState] Action Dispatched: ${e.type}`,e.payload),p.publish("state:changed",{newState:h,oldState:t,action:e}),e.type==="SET_SELECTION"&&p.publish("state:selectionChanged",h.currentSelection)},getState(){return h},getMap(){return h.map},getCurrentSelection(){return{...h.currentSelection}},getUICachedElement(e){return h.ui.elements[e]},getVisibleFeatures(){return h.cache.visibleFeatures},getOpenPopups(){return h.ui.openPopups},getBeachById(e){return h.cache.beachData.get(e)},getPOIById(e){return h.cache.poiData.get(e)}},E={isMobileView(){return window.innerWidth<=d.MAP.MOBILE_BREAKPOINT},debounce(e,t){let i;return function(...s){const n=()=>{clearTimeout(i),e(...s)};clearTimeout(i),i=setTimeout(n,t)}},showLoading(e){e.innerHTML='<div class="loader" style="display: flex; justify-content: center; padding: 20px;">Loading...</div>'},showError(e,t){e.innerHTML=`<div class="error" style="padding: 20px; text-align: center; color: #d32f2f;">${t}</div>`},getFeatureEntityId(e){if(!e)return null;const t=e.properties||{};return t["Item ID"]||t["Location Cluster"]||t.NAME||t.Name||e.id},updateElement({element:e,value:t,type:i="text",defaultValue:a="N/A",transform:s}){if(!e)return;let n=t??a;switch(s&&(n=s(n)),i){case"href":e.href=n;break;case"src":e.src=n;break;case"html":e.innerHTML=n;break;default:e.textContent=n}},renderView(e,t){!e||!t||e.querySelectorAll("[data-bind]").forEach(i=>{const a=i.dataset.bind,s=t[a];s!=null?i.tagName==="A"?i.href=s:i.tagName==="IMG"?i.src=s:i.textContent=s:i.textContent=""})}},_={execute(e,t={}){const i=d.EVENT_ACTIONS[e];if(!i){console.warn(`[ActionController] No action configured for '${e}'.`);return}if(!t.feature&&t.target){const{entityType:a,featureId:s}=t.target.dataset;a&&s&&(t.feature=o.getState().cache.visibleFeatures.get(s),t.entityType=a)}console.log(`[ActionController] Executing action: '${e}'`,t),i.actions.forEach(a=>{if(a.when){const s=Object.keys(a.when)[0],n=a.when[s];let c=!1;if(s==="context"&&(n==="isMobile"&&(c=E.isMobileView()),n==="isDesktop"&&(c=!E.isMobileView())),!c)return}this.runAction(a,t)})},runAction(e,t){const{feature:i,entityType:a}=t;switch(e.type){case"FLY_TO":i&&i.geometry&&p.publish("map:flyTo",{coordinates:i.geometry.coordinates,zoom:e.zoomLevel,speed:e.speed});break;case"FLY_TO_DEFAULT_POSITION":const s=E.isMobileView()?d.MAP.MOBILE_START_POSITION:d.MAP.DESKTOP_START_POSITION,n=d.MAP.DEFAULT_ZOOM;p.publish("map:flyTo",{coordinates:s,zoom:n});break;case"UPDATE_APP_STATE":if(i&&a){const c=i.properties["Item ID"]||i.id;o.dispatch({type:"SET_SELECTION",payload:{type:a,id:c,feature:i}})}break;case"SHOW_SIDEBAR":p.publish("ui:sidebarRequested",{sidebar:e.sidebar});break;case"SHOW_POPUP":if(i){const c=i.properties["Item ID"]||i.id;let r;a==="poi"?r=o.getPOIById(c):r=o.getBeachById(c),p.publish("map:showPopup",{feature:i,details:r,delay:e.delay,entityType:a})}break;case"CLOSE_ALL_POPUPS":p.publish("map:closeAllPopups");break;case"ZOOM_TO":p.publish("map:zoomTo",{zoom:e.zoomLevel,speed:e.speed});break;case"TOGGLE_FULLSCREEN":p.publish("ui:fullscreenToggled");break;default:console.warn(`[ActionController] Unknown action type: '${e.type}'`)}}},C={init(){},renderFeatureList(e=[],t="beach"){console.log(`[FeatureListView] renderFeatureList for type: ${t}`,e);const i=o.getUICachedElement("BEACH_LIST_CONTAINER");if(!i){console.error("Beach list container not found. Check config selector: BEACH_LIST_CONTAINER");return}if(i.innerHTML="",e.length===0){i.innerHTML='<p style="padding: 20px; text-align: center;">No items in view. Pan or zoom the map to find some.</p>';return}const a=c=>c.Name||c.State||c["Location Cluster"]||"";e.sort((c,r)=>a(c.properties).localeCompare(a(r.properties)));const s=new Set,n=[];e.forEach(c=>{if(t==="beach"){const r=c.properties["Item ID"];r&&!s.has(r)&&(s.add(r),n.push(c))}else n.push(c)}),o.dispatch({type:"SET_VISIBLE_FEATURES",payload:n}),n.forEach(c=>{const r=this.createListItem(c,t);i.appendChild(r)})},createListItem(e,t){const i=d.FEATURE_CONFIG[t];if(!i)return console.error(`No template configuration found for type: ${t}`),document.createElement("div");const a=document.querySelector(i.templateId);if(!a)return console.error(`Template element not found for ID: ${i.templateId}`),document.createElement("div");const n=a.content.cloneNode(!0).firstElementChild,c=e.properties,r=E.getFeatureEntityId(e);o.getVisibleFeatures().get(String(r))||console.warn(`[UIController] Feature with ID ${r} not found in cache. List item may not work correctly.`),n.dataset.entityType=t,n.dataset.featureId=r,n.setAttribute("action-trigger",i.actionName);for(const u in i.dataMapping){const b=n.querySelector(u),T=i.dataMapping[u];if(b)switch(T.type){case"text":b.textContent=T.source(c)||"";break;case"image":b.src=T.source(c),b.alt=c.Name||"List item image";break;case"style":Object.assign(b.style,T.style);break}else console.warn(`[FeatureListView] Element for selector "${u}" not found in template "${i.templateId}"`)}return n}},L={init(){},async updateDetailSidebar(){const{id:e,type:t}=o.getCurrentSelection(),i=o.getUICachedElement("SIDEBAR_BEACH");if(console.log(`[DEBUG-DetailView] Updating sidebar for ID: ${e}, type: ${t}`),!e||!i)return;let a;if(t==="poi"){a=o.getPOIById(e);const r=o.getState().cache.poiData;if(console.log(`[DEBUG-DetailView] POI Cache has ${r.size} items. Cache keys:`,Array.from(r.keys())),!a){console.error(`[DetailView] Could not find POI with ID ${e} in cache.`);return}}else{a=o.getBeachById(e);const r=o.getState().cache.beachData;if(console.log(`[DEBUG-DetailView] Beach Cache has ${r.size} items. Cache keys:`,Array.from(r.keys())),!a){console.error(`[DetailView] Could not find beach with ID ${e} in cache.`);return}}console.log("[DEBUG-DetailView] Details object from cache:",a);let s;t==="poi"?s={imageUrl:a.mainImageUrl||a["main-image"]?.url||"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",name:a.name||a.Name||"Point of Interest",googleMapsUrl:a["google-maps-link"]||a.googleMapsUrl||"#",address:a.address||a["formatted-address"]||a["formatted-adress"]||"Address not available",websiteUrl:a.website||a["website-url"],websiteHost:(a.website||a["website-url"])&&(a.website||a["website-url"]).startsWith("http")?new URL(a.website||a["website-url"]).hostname:"",phone:a.phone||"N/A",restrooms:"N/A",showers:"N/A",pets:"N/A",parking:"N/A",parkingHours:"N/A",camping:"N/A",bonfire:"N/A",fishing:"N/A",pier:"N/A",picnic:"N/A",surfing:"N/A",recreation:a.categoryName||a.category||a.type||"Point of Interest",airTemp:"N/A",feelsLike:"N/A",humidity:"N/A",wind:"N/A",windDirection:"N/A",aqi:"N/A",rainfall:"N/A",pressure:"N/A",pm25:"N/A",pm10:"N/A",waterTemp:"N/A",waveHeight:"N/A",oceanCurrent:"N/A",uvIndex:"N/A",cloudCover:"N/A",sunset:"N/A"}:s={imageUrl:a["main-image"]?.url||"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=300",name:a.name||"Beach Name",googleMapsUrl:a["google-maps-link"]||"#",address:a["formatted-address"]||a["formatted-adress"]||"Google Maps Link",websiteUrl:a["beach-website"],websiteHost:a["beach-website"]&&a["beach-website"].startsWith("http")?new URL(a["beach-website"]).hostname:"",phone:a.phone||"N/A",restrooms:a.restrooms||"N/A",showers:a.showers||"N/A",pets:a["pets-allowed"]||"N/A",parking:a["parking-lot-nearby"]||"N/A",parkingHours:a["parking-hours"]||"N/A",camping:a["camping-offered"]||"N/A",bonfire:a["bonfire-availabiliity"]||"N/A",fishing:a.fishing||"N/A",pier:a.pier||"N/A",picnic:a["picnic-area-rentals"]||"N/A",surfing:a["surfing-beach"]||"N/A",recreation:a["recreation-activities"]||"N/A",airTemp:a.temperature?`${Math.round(a.temperature)}`:"",feelsLike:a.feels_like?`${Math.round(a.feels_like)}°F`:"N/A",humidity:a.humidity?`${a.humidity}%`:"N/A",wind:a.windSpeed?`${a.windSpeed} mph`:"N/A",windDirection:a.windDirection?`${a.windDirection}°`:"N/A",aqi:a.aqi??"N/A",rainfall:a.rainfall?`${a.rainfall} in`:"N/A",pressure:a.pressure?`${a.pressure} inHg`:"N/A",pm25:a.pm25?`${a.pm25} µg/m³`:"N/A",pm10:a.pm10?`${a.pm10} µg/m³`:"N/A",waterTemp:a.water_temp?`${Math.round(a.water_temp)}°F`:"N/A",waveHeight:a.wave_height?`${a.wave_height} ft`:"N/A",oceanCurrent:a.ocean_current??"N/A",uvIndex:a.uv_index??"N/A",cloudCover:a.cloud_cover?`${a.cloud_cover}%`:"N/A",sunset:a.sunset?new Date(a.sunset).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A"};const n={imageUrl:"image",name:"title",googleMapsUrl:"address-link",address:"address-text",websiteUrl:"website-link",websiteHost:"website-text",phone:"phone",restrooms:"restrooms",showers:"showers",pets:"pets",parking:"parking",parkingHours:"parking-hours",camping:"camping",bonfire:"bonfire",fishing:"fishing",pier:"pier",picnic:"picnic",surfing:"surfing",recreation:"recreation",airTemp:"air-temp",feelsLike:"feels-like",humidity:"humidity",wind:"wind",windDirection:"wind-direction",aqi:"aqi",rainfall:"rainfall",pressure:"pressure",pm25:"pm25",pm10:"pm10",waterTemp:"water-temp",waveHeight:"wave-height",oceanCurrent:"ocean-current",uvIndex:"uv-index",cloudCover:"cloud-cover",sunset:"sunset"};for(const r in n)if(Object.prototype.hasOwnProperty.call(s,r)){const m=n[r],l=i.querySelector(`[beach-data="${m}"]`),u=s[r];l&&(l.tagName==="A"?l.href=u:l.tagName==="IMG"?(l.src=u,l.alt=s.name):l.textContent=u)}const c=i.querySelector('[data-bind-parent="websiteUrl"]');c&&(c.style.display=s.websiteUrl?"flex":"none")},async fetchWeatherData(e){const t=o.getState().cache.weatherData.get(e);if(t)return console.log("[DetailView] fetchWeatherData cache hit",e),t;try{const i=await fetch(`${y.BASE_URL}/api/weather/${e}`);if(!i.ok)throw new Error("Weather data not available");const a=await i.json();return console.log("[DetailView] fetchWeatherData fetched",a),o.dispatch({type:"SET_WEATHER_DATA",payload:{id:e,data:a}}),setTimeout(()=>{o.dispatch({type:"DELETE_WEATHER_DATA",payload:{id:e}})},300*1e3),a}catch(i){return console.error("[DetailView] Error fetching weather data:",i),null}}},O={init(){console.log("[ResponsiveService] init"),this.updateLayout(),window.addEventListener("resize",E.debounce(()=>{this.updateLayout()},250))},updateLayout(){const e=E.isMobileView(),t=o.getState().ui.isMobile;e!==t&&(console.log(`[ResponsiveService] View changed to ${e?"mobile":"desktop"}`),o.dispatch({type:"SET_UI_STATE",payload:{isMobile:e}}),p.publish("ui:viewChanged",{isMobile:e}))}},g={init(){console.log("[UIController] init as coordinator"),this.cacheElements(),this.setupEventListeners(),this.setupBusSubscriptions(),C.init(),O.init()},cacheElements(){console.log("[UIController] cacheElements");const e={};Object.entries(d.SELECTORS).forEach(([t,i])=>{const a=document.querySelector(i);a?e[t]=a:console.warn(`[UIController] Element not found: ${i}`)}),o.dispatch({type:"SET_UI_STATE",payload:{elements:e}})},setupEventListeners(){console.log("[UIController] setupEventListeners"),document.body.addEventListener("click",e=>{const t=e.target.closest("[action-trigger]");if(!t)return;e.preventDefault();const i=t.getAttribute("action-trigger");i&&(console.log(`[UIController] Action triggered: ${i}`),_.execute(i,{target:t,source:"sidebar-list-item"}))})},setupBusSubscriptions(){p.subscribe("state:selectionChanged",e=>{(e?.type==="beach"||e?.type==="poi")&&L.updateDetailSidebar()}),p.subscribe("ui:sidebarRequested",e=>this.showSidebar(e.sidebar)),p.subscribe("ui:fullscreenToggled",this.toggleFullscreen.bind(this)),p.subscribe("ui:viewChanged",()=>this.showSidebar(o.getState().ui.currentSidebar))},handleSelectionChange(e){(!e||e.type!=="beach")&&o.getState().ui.currentSidebar==="detail"&&this.showSidebar("list")},showSidebar(e){console.log(`[UIController] showSidebar: ${e}`),o.dispatch({type:"SET_UI_STATE",payload:{currentSidebar:e}});const{SIDEBAR_WRAPPER:t,SIDEBAR_HOME:i,SIDEBAR_BEACH_LIST:a,SIDEBAR_BEACH:s}=o.getState().ui.elements;if(!t)return;i&&(i.style.display="none"),a&&(a.style.display="none"),s&&(s.style.display="none");let n;switch(e){case"home":n=i;break;case"list":n=a;break;case"detail":n=s;break}n&&(n.style.display="block"),t.style.display="block",delete t.dataset.activeSidebar,o.getState().ui.isMobile?this.hideMap():this.showMap()},showMap(){console.log("[UIController] showMap");const e=o.getUICachedElement("SIDEBAR_MAP");e&&(e.style.display="block")},hideMap(){console.log("[UIController] hideMap");const e=o.getUICachedElement("SIDEBAR_MAP");e&&(e.style.display="none")},toggleFullscreen(){console.log("[UIController] toggleFullscreen");const{SIDEBAR_MAP:e,SIDEBAR_WRAPPER:t}=o.getState().ui.elements;if(o.getState().ui.isMobile)e&&e.style.display==="none"?(this.hideMap(),this.showSidebar(o.getState().ui.currentSidebar)):(this.showMap(),t&&(t.style.display="none"));else{if(t){const i=t.style.display!=="none";t.style.display=i?"none":"block"}this.showMap()}},renderFeatureList(e,t){console.log(`[UIController] renderFeatureList for type: ${t}`,e),C.renderFeatureList(e,t)}},M={features:[{type:"Feature",properties:{Name:"Hilo",Slug:"hilo","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516c9cced1885ded4216fc",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:24:44 GMT+0000 (Coordinated Universal Time)","Updated On":"Thu Jun 26 2025 08:11:46 GMT+0000 (Coordinated Universal Time)","Published On":"Thu Jun 26 2025 08:11:46 GMT+0000 (Coordinated Universal Time)",Image:"https://cdn.prod.website-files.com/678661730ea760533db7153d/685d00c0066f35ff235125c1_hawaiian-islands-min.jpg"},geometry:null},{type:"Feature",properties:{Name:"Honolulu",Slug:"honolulu","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516c3ecd68e66ea0dc9b27",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:23:10 GMT+0000 (Coordinated Universal Time)","Updated On":"Thu Jun 26 2025 08:12:10 GMT+0000 (Coordinated Universal Time)","Published On":"Thu Jun 26 2025 08:12:10 GMT+0000 (Coordinated Universal Time)",Image:"https://cdn.prod.website-files.com/678661730ea760533db7153d/685d00cd75ee1977ab157fad_honolulu-min.jpg"},geometry:null},{type:"Feature",properties:{Name:"Kuai",Slug:"kuai","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516c2aa3b863be97349c11",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:22:50 GMT+0000 (Coordinated Universal Time)","Updated On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)","Published On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)",Image:""},geometry:null},{type:"Feature",properties:{Name:"Los Angeles",Slug:"los-angeles","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516dc57ef3bc9ef8f54766",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:29:41 GMT+0000 (Coordinated Universal Time)","Updated On":"Thu Jun 26 2025 08:11:26 GMT+0000 (Coordinated Universal Time)","Published On":"Thu Jun 26 2025 08:11:26 GMT+0000 (Coordinated Universal Time)",Image:"https://cdn.prod.website-files.com/678661730ea760533db7153d/685d00ab84ef1711792a5fac_la-min.jpg"},geometry:null},{type:"Feature",properties:{Name:"Maui",Slug:"maui","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516c6431a74f2ee68df7d3",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:23:48 GMT+0000 (Coordinated Universal Time)","Updated On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)","Published On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)",Image:""},geometry:null},{type:"Feature",properties:{Name:"Salinas",Slug:"salinas","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516d362b78dd5f2a6daaa7",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:27:18 GMT+0000 (Coordinated Universal Time)","Updated On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)","Published On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)",Image:""},geometry:null},{type:"Feature",properties:{Name:"San Diego",Slug:"san-diego","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516dd925006c72d02c6f1a",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:30:01 GMT+0000 (Coordinated Universal Time)","Updated On":"Thu Jun 26 2025 08:11:11 GMT+0000 (Coordinated Universal Time)","Published On":"Thu Jun 26 2025 08:11:11 GMT+0000 (Coordinated Universal Time)",Image:"https://cdn.prod.website-files.com/678661730ea760533db7153d/685d009ce55d7bf179d27c17_san-diego-min.jpg"},geometry:null},{type:"Feature",properties:{Name:"San Francisco",Slug:"san-francisco","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516ccd4c9f3124c6ad72df",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:25:33 GMT+0000 (Coordinated Universal Time)","Updated On":"Thu Jun 26 2025 08:11:38 GMT+0000 (Coordinated Universal Time)","Published On":"Thu Jun 26 2025 08:11:38 GMT+0000 (Coordinated Universal Time)",Image:"https://cdn.prod.website-files.com/678661730ea760533db7153d/685d00b8d3ebee9be09ac549_san-fransisco-min.jpg"},geometry:null},{type:"Feature",properties:{Name:"Santa Cruz",Slug:"santa-cruz","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516d1d147c4622c39eac61",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:26:53 GMT+0000 (Coordinated Universal Time)","Updated On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)","Published On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)",Image:""},geometry:null},{type:"Feature",properties:{Name:"Santa Maria",Slug:"santa-maria","Collection ID":"68516bf41dee6544b85f95b2","Locale ID":"678661730ea760533db7153c","Item ID":"68516d819e3f01bd9a77c8aa",Archived:"false",Draft:"false","Created On":"Tue Jun 17 2025 13:28:33 GMT+0000 (Coordinated Universal Time)","Updated On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)","Published On":"Tue Jun 17 2025 13:44:32 GMT+0000 (Coordinated Universal Time)",Image:""},geometry:null}]},v={LAYER_IDS:{STATES:"salty-state",CALIFORNIA:"California",HAWAII:"Hawaii",REGIONS:"salty-city",BEACHES:"salty-beaches",POIS:"salty-pois"},hoveredFeature:null,hoverPopup:null,hoverTimeout:null,async init(){try{mapboxgl.accessToken=d.MAP.ACCESS_TOKEN;const e=new mapboxgl.Map({container:d.SELECTORS.MAP_CONTAINER.slice(1),style:d.MAP.STYLE,center:E.isMobileView()?d.MAP.MOBILE_START_POSITION:d.MAP.DESKTOP_START_POSITION,zoom:d.MAP.DEFAULT_ZOOM,pitch:d.MAP.START_PITCH});e.on("load",()=>{o.dispatch({type:"SET_MAP_INSTANCE",payload:e}),this.setupEventHandlers(),this.setupBusSubscriptions(),console.log("✅ Map initialized with cloud-hosted data and styles.")});const t=document.querySelector(d.SELECTORS.MAP_CONTAINER);new ResizeObserver(()=>e.resize()).observe(t)}catch(e){console.error("Failed to initialize map:",e),E.showError(document.querySelector(d.SELECTORS.MAP_CONTAINER),"Failed to load map. Please check your connection and try again.")}},setupBusSubscriptions(){p.subscribe("map:flyTo",this.flyTo.bind(this)),p.subscribe("map:showPopup",e=>{e&&e.feature&&setTimeout(()=>this.showPopup(e.feature,e.details,e.entityType),e.delay||0)}),p.subscribe("map:closeAllPopups",this.closeAllPopups.bind(this)),p.subscribe("map:zoomTo",this.zoomTo.bind(this))},setupEventHandlers(){const e=Object.values(this.LAYER_IDS).filter(Boolean);if(e.length===0){console.warn("⚠️ No interactive layers are defined in LAYER_IDS. Clicks will not work.");return}o.getMap().on("click",e,t=>{if(!t.features||t.features.length===0)return;const i=t.features[0];let a,s;switch(i.layer.id){case this.LAYER_IDS.BEACHES:a="beach",s="selectBeachFromMap";break;case this.LAYER_IDS.POIS:a="poi",s="selectPOIFromMap";break;case this.LAYER_IDS.REGIONS:a="region",s="selectRegion";break;case this.LAYER_IDS.STATES:a="state",s="selectState";break;default:return}s&&_.execute(s,{entityType:a,feature:i})}),o.getMap().on("mousemove",e,t=>{t.features.length>0&&(o.getMap().getCanvas().style.cursor="pointer",this.hoveredFeature&&this.hoveredFeature.id===t.features[0].id||(this.hoveredFeature&&o.getMap().setFeatureState(this.hoveredFeature,{state:!1}),this.hoveredFeature=t.features[0],o.getMap().setFeatureState(this.hoveredFeature,{state:!0}),E.isMobileView()||(clearTimeout(this.hoverTimeout),this.hoverTimeout=setTimeout(()=>{this.hoverPopup&&this.hoverPopup.remove();const i=this.hoveredFeature;let a;switch(i.layer.id){case this.LAYER_IDS.BEACHES:a="beach";break;case this.LAYER_IDS.POIS:a="poi";break;default:return}const s=i.properties["Item ID"]||i.id,n=a==="poi"?o.getPOIById(s):o.getBeachById(s);this.hoverPopup=this.showPopup(i,n,a,!0)},d.UI.HOVER_POPUP_DELAY))))}),o.getMap().on("mouseleave",e,()=>{clearTimeout(this.hoverTimeout),this.hoverPopup&&(this.hoverPopup.remove(),this.hoverPopup=null),this.hoveredFeature&&o.getMap().setFeatureState(this.hoveredFeature,{state:!1}),this.hoveredFeature=null,o.getMap().getCanvas().style.cursor=""}),o.getMap().on("moveend",E.debounce(async()=>{console.log("🗺️ Map moveend event");const{ui:t}=o.getState();if(t.currentSidebar!=="list"){console.log(`[MapController] Sidebar update skipped, current view is "${t.currentSidebar}".`);return}await this.updateSidebarListFromMap()},250))},async updateSidebarListFromMap(){const e=o.getMap();if(!e)return;const t=e.queryRenderedFeatures({layers:[this.LAYER_IDS.BEACHES]});if(t.length>0){console.log(`[MapController] Found ${t.length} individual beaches in view.`),g.renderFeatureList(t,"beach");return}const i=e.queryRenderedFeatures({layers:[this.LAYER_IDS.POIS]});if(i.length>0){console.log(`[MapController] Found ${i.length} POI features in view.`),g.renderFeatureList(i,"poi");return}const a=e.queryRenderedFeatures({layers:[this.LAYER_IDS.REGIONS]});if(a.length>0){const n=a[0].layer.source,c=e.getSource(n),r=await Promise.all(a.map(l=>new Promise(u=>{if(!l.properties.cluster){l.properties.point_count=1,u(l);return}c.getClusterLeaves(l.properties.cluster_id,1/0,0,(b,T)=>{if(b){console.error("Could not get cluster leaves:",b),l.properties.point_count=l.properties.point_count_abbreviated||1,u(l);return}l.properties.point_count=T.length,u(l)})})));console.log(`[MapController] Found ${r.length} regions in view.`);const m=new Map(M.features.map(l=>[l.properties.Name,l.properties.Image]));r.forEach(l=>{const u=l.properties.name;m.has(u)&&(l.properties.Image=m.get(u))}),g.renderFeatureList(r,"region");return}const s=e.queryRenderedFeatures({layers:[this.LAYER_IDS.STATES]});if(s.length>0){console.log(`[MapController] Found ${s.length} states in view.`),g.renderFeatureList(s,"state");return}console.log("[MapController] No features found in view, clearing list."),g.renderFeatureList([])},showPopup(e,t,i,a=!1){const s=e.geometry.coordinates.slice(),n=t||e.properties,c=t?t["main-image"]?.url:n["Main Image"],r=t?t.name:n.Name,m=t?t.richTextContent:n.richTextContent,l=t?t.adress:n["Formatted Adress"],u=t?t.hours:n.Hours,b=t?t["paid-partner"]:n["Paid Partner"],T=t?t["beach-website"]:n.Website,S=t?t.phone:n.Phone,R=t?t["button-link"]:n["Button Link"],U=t?t.button:n.button,B=t?t.buttonText:n.buttonText,F=`
      <div class="popup_component">
       <img src="${c||"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=300"}" alt="${r}" class="popup_image">
       ${b?'<p class="partner-badge">Paid Partner</p>':""}
        <div class="spacer-tiny"></div>
       <h4 class="popup_title">${r}</h4>
        <div class="spacer-xxsmall"></div>
        ${m?`<div class="popup_description">${m}</div>`:""}
       ${l?`<p class="popup_address">${l}</p>`:""}
       ${u?`<p class="popup_hours">Hours: ${u}</p>`:""}
       ${T?`<a href="${T}" target="_blank" class="salty-link">${T.replace(/^https?:\/\//,"")}</a>`:""}
       ${S?`<a href="tel:${S}" target="_blank" class="salty-link">${S}</a>`:""}
       <div class="spacer-xsmall"></div>
       ${i!=="poi"?'<div class="button is-icon w-inline-block" style="background-color: rgb(0, 116, 140);">See Details</div>':U?`<a href="${R}" target="_blank" class="button is-icon w-inline-block" style="background-color: rgb(0, 116, 140); text-decoration: none;">${B}</a>`:""}
      </div>
    `,A=new mapboxgl.Popup({offset:d.UI.POPUP_OFFSET}).setLngLat(s).setHTML(F).addTo(o.getMap());return a||(o.dispatch({type:"ADD_OPEN_POPUP",payload:A}),A.on("close",()=>{o.dispatch({type:"REMOVE_OPEN_POPUP",payload:A})}),A.getElement().addEventListener("click",P=>{P.target.tagName==="A"||P.target.closest("a")||i!=="poi"&&(_.execute("selectBeachFromPopup",{entityType:"beach",feature:e}),A.remove())})),A},closeAllPopups(){o.getOpenPopups().forEach(e=>e.remove()),o.dispatch({type:"CLEAR_OPEN_POPUPS"})},flyTo({coordinates:e,zoom:t=d.MAP.DETAIL_ZOOM,speed:i=d.UI.MAP_FLY_SPEED}){const a=o.getMap();a&&a.flyTo({center:e,zoom:t,speed:i})},zoomTo({zoom:e,speed:t=1.2}){const i=o.getMap();i&&i.easeTo({zoom:e,speed:t})}},N={async init(){console.log("[DataController] Initializing data pre-fetch."),await Promise.all([this.prefetchAllBeachData(),this.prefetchAllPOIData()])},async prefetchAllBeachData(){try{const e=await fetch(`${y.BASE_URL}/api/beaches`);if(console.log("[DataController] Fetch response status:",e.status),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();console.log(`[DataController] Fetched ${t.length} beach items.`),o.dispatch({type:"SET_ALL_BEACH_DATA",payload:t}),console.log("[DataController] All beach data pre-fetched and cached.")}catch(e){console.error("[DataController] Failed to pre-fetch beach data:",e)}},async prefetchAllPOIData(){try{const e=await fetch(`${y.BASE_URL}/api/pois`);if(console.log("[DataController] POI fetch response status:",e.status),!e.ok){console.warn(`[DataController] POI API not available (status: ${e.status}), using mock data`);const i=[{id:"huntington-city-beach-lifeguard-tower-1",name:"Huntington City Beach Lifeguard Tower 1",slug:"huntington-lifeguard-tower-1",longitude:-118.0052,latitude:33.6553,categoryName:"Safety & Emergency",customIconName:"lifeguard-tower",mainImageUrl:"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",mainImageAlt:"Huntington City Beach Lifeguard Tower 1",richTextContent:"<p>Professional lifeguard station providing safety services and emergency response at Huntington City Beach.</p>",geometry:{type:"Point",coordinates:[-118.0052,33.6553]}}];o.dispatch({type:"SET_ALL_POI_DATA",payload:i}),console.log("[DataController] Mock POI data cached.");return}const t=await e.json();console.log(`[DataController] Fetched ${t.length} POI items.`),o.dispatch({type:"SET_ALL_POI_DATA",payload:t}),console.log("[DataController] All POI data pre-fetched and cached.")}catch(e){console.error("[DataController] Failed to pre-fetch POI data:",e);const t=[{id:"huntington-city-beach-lifeguard-tower-1",name:"Huntington City Beach Lifeguard Tower 1",slug:"huntington-lifeguard-tower-1",longitude:-118.0052,latitude:33.6553,categoryName:"Safety & Emergency",customIconName:"lifeguard-tower",mainImageUrl:"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",mainImageAlt:"Huntington City Beach Lifeguard Tower 1",richTextContent:"<p>Professional lifeguard station providing safety services and emergency response at Huntington City Beach.</p>",geometry:{type:"Point",coordinates:[-118.0052,33.6553]}}];o.dispatch({type:"SET_ALL_POI_DATA",payload:t}),console.log("[DataController] Fallback to mock POI data due to error.")}}};document.addEventListener("DOMContentLoaded",()=>{N.init(),g.init(),v.init()})});
